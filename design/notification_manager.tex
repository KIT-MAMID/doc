\section{Notifier}
\beginpackage{notifier}

The notifier is installed with the master. 
Notifies a predefined list of contacts whenever a new \refgo{master.Problem} occurs.

\struct{Controller}{
	Imports CLIFFagParser to parse command line parameters, such as the path to the contact file.
	Imports os, io and fmt to parse the contacts file.
	Receives problems via \reftype{APIClient}.\\
	Determines which problems should be send.\\
	Starts implementations of notifier to send the problems.	
}{
	\property{lastProblems}[[]Problem]{
		List of recent problems.
	}
}{
	\method{main}
	{
		A Go application starts by initializing the Go 'main' package and then running the \textit{main()} function.
		\begin{itemize}
			\item Receives problems through the \reftype{APIClient}.
			\item Uses reftype{diffProblems} to decide which should be send.
			\item Uses reftype{notify} to hand over problems to a \reftype{Notifier}.
		\end{itemize}
	}
	\method{diffProblems}[[]Problem](
		\param{received}[[]Problems]{List of recently send problems}
		){
		Compares \refproperty{lastProblems} to the problems currently staged for notification.
		To prevent spam only a new \refgo{master.Problem} will be send
	}
	\method{notify}(
		\param{problem}[Problem]{The problem to be send}
	){
		Hands over problems to a \reftype{Notifier}.
	}
}

\struct{Parser}{
	Used by the \reftype{Controller} to parse the contact file.
}{
	\method{Parse}[[]\reftype{Contact}, error](
		\param{path}[string]{Path of the contacts file}
		){
			Parses the contacts file.
			Returns an array of contacts.	
		}
}

\struct{APIClient}{
	Receives new problems from the master.
	}{
	\method{Receive}[[]Problem](
		\param{host}[string]{
			Hostname of the APIServer
			}
		){
		}
}

\interface{Notifier}{
	}{
	\method{Send}(
		\param{problem}[Problem]
		){Receive the problem and send it to the contacts}
}

\struct{EmailNotifier}{
	Imports smtp.
	Implements \reftype{Notifier} to send emails via smtp to a list of EmailContacts.
}{
	\property{Contact}[[]EmailContact]
}{
	\method{Send}(
		\param{problem}[Problem]{The \refgo{master.Problem} to be send}
		){
			Translates the problem into an email message.
		}
	\method{sendMailToContacts}[](
		\param{msg}[[]byte]{}
		){
			Sends the messages created by \refmethod{Send} to a list of email contacts.
			Uses the GO smtp package.
		}
}

\interface{Contact}{
	Interface for contactdata of the recipents of problem notifications.\newline
	Contactdata is read from the contacts file.
}{
	\property{contactData}[string]
}

\struct{EmailContact}{
	Implements \reftype{Contact}.
}{
	\property{Address}[string]{Email address of one contact}
}
\struct{SMTPRelay}{
		An email relay using SMTP.
}{
	\property{Hostname}[string]{Hostname of the SMTP Relay}
	\property{MailFrom}[string]{The email address from which the notifications will be send}
}
