
%http://tex.stackexchange.com/questions/43002/how-to-preserve-the-same-parskip-in-minipage
\newlength{\currentparskip}
\newenvironment{minipageparskip}
{\setlength{\currentparskip}{\parskip}% save the value
	\begin{minipage}{\textwidth}% open the minipage
		\setlength{\parskip}{0.8em}% restore the value
	}
	{\end{minipage}}

% Args: Method, URI, 
\newcommand{\apicall}[8][]{
\begin{minipageparskip}
	\paragraph{\framebox{\uppercase{#1}} #2 - #3}
	\begin{description}[leftmargin=!,labelwidth=\widthof{\bfseries Return Codesaa}] %aa intentioal -  more distance
		\item[Parameters]
		\if\relax\detokenize{#4}\relax
		\emph{None}
		\else
		\begin{tabularx}{\linewidth}{c|c|*1{>{\centering\arraybackslash}X}@{}}
			\textbf{Parameter} & \textbf{Data Type} & \textbf{Description}\\
			\hline
			#4
		\end{tabularx}
		\fi
		
		\item[Returns]
		\begin{description}[leftmargin=!,labelwidth=\widthof{\bfseries Status Codeaa}] %aa intentioal -  more distance
			\item[Status Code] #5
			\ifthenelse{\equal{#6}{}}
			{} % optional argument #1 is empty: skip
			{\item[Headers] \begin{tabularx}{\linewidth}{c|*1{>{\centering\arraybackslash}X}@{}}
					\textbf{HTTP Header} & \textbf{Content}\\
					\hline
					#6
			\end{tabularx}}
			\ifthenelse{\equal{#7}{}}
			{\item[Body] \emph{Empty}} % optional argument #1 is empty: skip
			{\item[Body] #7}
		\end{description}
		
		\item[Error Codes]
		\begin{tabularx}{\linewidth}{c|*1{>{\centering\arraybackslash}X}@{}}
			\textbf{HTTP Status Code} & \textbf{Reason}\\
			\hline%
\ifthenelse{\equal{#1}{put}}{400 & Invalid parameters in object}{}%
\ifthenelse{\equal{#1}{get}}{404 & Object does not exist}{}%
\ifthenelse{\equal{#1}{post}}{404 & Object does not exist\\400 & Invalid parameters in object or parameter may not be changed}{}%
\ifthenelse{\equal{#1}{delete}}{404 & Object does not exist}{}%
\if\relax\detokenize{#8}\relax
\else
\\#8
\fi
		\end{tabularx}
	\end{description}
\end{minipageparskip}
\vspace{1em}
}

\section{Master API}
%TODO General api description
%Uses RESTful HTTP
%Generic error responses
\subsection{API Objects}
API Objects are exchanged in JSON format.
\subsubsection{Slave}
\begin{lstlisting}
{
	"hostname": <string>,
	"slave_port": <int>,
	"mongod_port_range_begin": <int (inclusive)>,
	"mongod_port_range_end": <int (exclusive)>,
	"persistant_storage": <bool>,
	"root data directory": <string>,
	"state": <string>
}
\end{lstlisting}
\subsubsection{Replica Sets}
\begin{lstlisting}
{
	"name": <string>,
	"persistent_node_count": <int>,
	"volatile_node_count": <int>,
	"configure_as_sharding_config_server": <bool>
}
\end{lstlisting}
\subsection{API Methods}
\subsubsection{Slaves}
%Do not add default error codes
\apicall[get\relax]{/slaves}{Gets all slaves}
	{}
	{200}
	{}
	{array of slave objects}
	{}

\apicall[put]{/slave}{Adds a slave}
	{slave & slave object & slave to add}
	{201}
	{Location & Reference to added slave}
	{}
	{}
	
\apicall[get]{/slave/<id>}{Gets a slave}
	{id & integer & id of the slave to get}
	{200}
	{}
	{slave object}
	{}
	
\apicall[post]{/slave/<id>}{Updates a slave}
	{id & integer & id of the slave to update}
	{200}
	{}
	{}
	{}
	
\apicall[delete]{/slave/<id>}{Deletes a slave}
	{id & integer & id of the slave to update}
	{200}
	{}
	{}
	{}
	
\subsubsection{Replica Sets}
%Do not add default error codes
\apicall[get\relax]{/replicasets}{Gets all replica sets}
	{}
	{200}
	{}
	{array of replica set objects}
	{}

\apicall[put]{/replicaset}{Adds a replica set}
	{replicaset & replica set object & replica set to add}
	{201}
	{Location & Reference to added replica set}
	{}
	{}

\apicall[get]{/replicaset/<id>}{Gets a replica set}
	{id & integer & id of the replica set to get}
	{200}
	{}
	{replica set object}
	{}

\apicall[post]{/replicaset/<id>}{Updates a replica set}
	{id & integer & id of the replica set to update}
	{200}
	{}
	{}
	{}

\apicall[delete]{/replicaset/<id>}{Deletes a replica set}
	{id & integer & id of the replica set to update}
	{200}
	{}
	{}
	{}

\apicall[get]{/replicaset/<id>/slaves}{Gets a replica sets slaves}
	{id & integer & id of the replica set to get}
	{200}
	{}
	{array of slave objects}
	{}